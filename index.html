<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI å½±ç‰‡å°æ¼”å·¥ä½œå° (V5 æ——è‰¦ç‰ˆ)</title>
    <style>
        :root {
            --primary: #4f46e5;
            --secondary: #ec4899; /* å¢åŠ ä¸€é»å°æ¯”è‰² */
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --text: #1f2937;
            --danger-bg: #fee2e2;
            --danger-border: #ef4444;
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); padding: 20px; line-height: 1.6; }
        .container { max-width: 1100px; margin: 0 auto; }
        
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: var(--primary); margin: 0; font-size: 2.2rem; }
        .header p { color: #6b7280; font-size: 0.95rem; }

        /* Tabs */
        .tabs { display: flex; justify-content: center; margin-bottom: 25px; background: #e5e7eb; padding: 5px; border-radius: 12px; display: inline-flex; }
        .tab { padding: 10px 30px; cursor: pointer; border-radius: 8px; font-weight: bold; transition: 0.3s; color: #6b7280; }
        .tab.active { background: white; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* Dashboard Layout */
        .dashboard { display: grid; grid-template-columns: 380px 1fr; gap: 25px; }
        .sidebar { background: var(--card-bg); padding: 25px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); height: fit-content; }
        .main-content { background: var(--card-bg); padding: 25px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); min-height: 600px; }

        /* Forms */
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: 700; margin-bottom: 8px; color: #374151; }
        input, textarea, select { width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; box-sizing: border-box; transition: 0.2s; background: #f9fafb; }
        input:focus, textarea:focus, select:focus { border-color: var(--primary); outline: none; background: white; ring: 2px solid #e0e7ff; }
        textarea { resize: vertical; }

        /* API Key Box */
        .api-key-box { 
            background: var(--danger-bg); 
            border: 2px dashed var(--danger-border); 
            padding: 15px; 
            border-radius: 12px; 
            margin-bottom: 25px; 
        }
        .api-key-box label { color: #b91c1c; display: flex; justify-content: space-between; align-items: center; }
        .api-key-box input { border: 1px solid var(--danger-border); background: #fff; }
        .status-badge { font-size: 11px; background: #10b981; color: white; padding: 2px 8px; border-radius: 4px; display: none; }

        /* Button */
        .btn-primary { width: 100%; background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%); color: white; padding: 14px; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 5px; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3); }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 16px rgba(79, 70, 229, 0.4); }

        /* Output Cards */
        .output-card { background: #f8fafc; border: 1px solid #e2e8f0; padding: 0; margin-bottom: 25px; border-radius: 12px; overflow: hidden; }
        .output-header { background: #f1f5f9; padding: 12px 20px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
        .output-body { padding: 20px; }
        
        .scene-badge { background: var(--primary); color: white; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        
        /* ä¸­è‹±å°ç…§æ¨£å¼ */
        .zh-desc { background: #fffbeb; border-left: 4px solid #f59e0b; padding: 12px; margin-bottom: 15px; font-size: 15px; color: #78350f; line-height: 1.6; }
        .en-prompt { font-family: 'Courier New', monospace; background: #1e293b; color: #e2e8f0; padding: 15px; border-radius: 8px; font-size: 14px; white-space: pre-wrap; border: 1px solid #334155; }
        
        .cta-note { margin-top: 15px; font-size: 13px; color: #6b7280; border-top: 1px dashed #d1d5db; padding-top: 10px; display: flex; align-items: center; gap: 5px; }

        .loading { text-align: center; padding: 60px; display: none; color: var(--primary); }
        .copy-btn { cursor: pointer; background: white; border: 1px solid #d1d5db; padding: 6px 12px; border-radius: 6px; font-size: 13px; font-weight: 600; color: #4b5563; transition: 0.2s; }
        .copy-btn:hover { border-color: var(--primary); color: var(--primary); background: #eef2ff; }

        @media (max-width: 900px) { .dashboard { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>ğŸ¬ AI å½±ç‰‡å°æ¼”å·¥ä½œå° (V5)</h1>
        <p>é›™èªé¢¨æ ¼å°ç…§ â€¢ æŒ‡å®šæ ¸å¿ƒï¼šGemini 2.5 Flash Lite</p>
    </div>

    <div style="text-align: center;">
        <div class="tabs">
            <div class="tab active" onclick="switchMode('story')">ğŸ“½ï¸ é€£è¼‰æ•…äº‹æ¨¡å¼</div>
            <div class="tab" onclick="switchMode('single')">ğŸ“¸ å–®é¡é ­æ¨¡å¼</div>
        </div>
    </div>

    <div class="dashboard">
        <div class="sidebar">
            
            <div class="api-key-box">
                <label>
                    ğŸ”‘ Gemini API Key 
                    <span id="keyStatus" class="status-badge">âœ… å·²å„²å­˜</span>
                </label>
                <input type="password" id="apiKeyInput" placeholder="è«‹åœ¨æ­¤è²¼ä¸Š API Key..." oninput="saveKey()">
            </div>

            <div class="form-group">
                <label>ğŸ¨ è¦–è¦ºé¢¨æ ¼ (Visual Style)</label>
                <select id="styleSelect">
                    <option value="Cinematic, 35mm lens, golden hour lighting">é›»å½±æ„Ÿ (Cinematic)</option>
                    <option value="Studio Ghibli anime style, warm tones">å‰åœåŠ›å‹•ç•« (Ghibli)</option>
                    <option value="Cyberpunk, neon rain, futuristic">è³½åšé¾å…‹ (Cyberpunk)</option>
                    <option value="Photorealistic wildlife documentary, 8k">ç”Ÿæ…‹ç´€éŒ„ç‰‡ (Documentary)</option>
                    <option value="Pixar 3D animation style, bright colors">çš®å…‹æ–¯ 3D (Pixar)</option>
                    <option value="Dark fantasy, misty, gothic atmosphere">æš—é»‘å¥‡å¹» (Dark Fantasy)</option>
                </select>
            </div>

            <div id="story-inputs">
                <div class="form-group">
                    <label>ğŸ“– æ•…äº‹å¤§ç¶±</label>
                    <textarea id="storyPrompt" rows="5" placeholder="è¼¸å…¥æ‚¨çš„æ•…äº‹æƒ³æ³•..."></textarea>
                </div>
                <div class="form-group">
                    <label>ğŸ”’ ä¸»è§’é–å®š (Consistency)</label>
                    <input type="text" id="characterAnchor" placeholder="ä¾‹å¦‚ï¼šCute red fox with blue scarf">
                    <small style="color:#666; font-size:12px;">*æ­¤æè¿°æœƒå¼·åˆ¶åŠ å…¥æ¯ä¸€å¹•ï¼Œç¢ºä¿é€£æˆ²ã€‚</small>
                </div>
                <div class="form-group">
                    <label>ğŸ“… åˆ†é¡æ•¸é‡</label>
                    <select id="dayCount">
                        <option value="3">3 å€‹åˆ†é¡</option>
                        <option value="5" selected>5 å€‹åˆ†é¡</option>
                    </select>
                </div>
            </div>

            <div id="single-inputs" class="hidden">
                <div class="form-group">
                    <label>ğŸ¯ ç•«é¢æè¿°</label>
                    <textarea id="singlePrompt" rows="6" placeholder="æè¿°ç•«é¢..."></textarea>
                </div>
            </div>

            <div class="form-group">
                <label>ğŸ“ ç•«å¹…æ¯”ä¾‹</label>
                <select id="aspectRatio">
                    <option value="--ar 9:16">9:16 (ç›´å‘ - IG/Tiktok)</option>
                    <option value="--ar 16:9">16:9 (æ©«å‘ - YT)</option>
                    <option value="--ar 1:1">1:1 (æ­£æ–¹å½¢)</option>
                </select>
            </div>

            <button class="btn-primary" onclick="generateScript()">âœ¨ å•Ÿå‹• Gemini 2.5</button>
        </div>

        <div class="main-content">
            <div id="loading" class="loading">
                <div style="font-size:2rem; margin-bottom:10px;">âš¡</div>
                <strong>Gemini 2.5 Flash Lite æ­£åœ¨é‹ç®—ä¸­...</strong><br>
                <span style="font-size:0.9rem; color:#666;">æ­£åœ¨ç¿»è­¯é¢¨æ ¼ä¸¦å»ºæ§‹åˆ†é¡...</span>
            </div>
            <div id="results-container">
                <div style="text-align: center; color: #9ca3af; margin-top: 100px;">
                    è«‹åœ¨å·¦å´ç´…è‰²æ¡†æ¡†è²¼ä¸Š API Key<br>è¼¸å…¥æ•…äº‹ä¸¦é»æ“Šç”Ÿæˆ
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const CTA_PHRASE = "\n\nIf you have a story you want to see, please leave a comment and let me know! I will consider turning your text into the main storyline!";
    // æŒ‡å®šæ¨¡å‹ ID
    const MODEL_ID = "models/gemini-2.5-flash-lite"; 
    
    let currentMode = 'story';

    window.onload = function() {
        const savedKey = localStorage.getItem("gemini_api_key_v5");
        if (savedKey) {
            document.getElementById("apiKeyInput").value = savedKey;
            document.getElementById("keyStatus").style.display = "inline-block";
        }
    }

    function saveKey() {
        const key = document.getElementById("apiKeyInput").value.trim();
        if (key) {
            localStorage.setItem("gemini_api_key_v5", key);
            document.getElementById("keyStatus").style.display = "inline-block";
        }
    }

    function switchMode(mode) {
        currentMode = mode;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');
        document.getElementById('story-inputs').classList.toggle('hidden', mode !== 'story');
        document.getElementById('single-inputs').classList.toggle('hidden', mode !== 'single');
    }

    async function generateScript() {
        const API_KEY = document.getElementById("apiKeyInput").value.trim();
        if (!API_KEY) {
            alert("ğŸš¨ è«‹å…ˆè¼¸å…¥ API Keyï¼");
            document.getElementById("apiKeyInput").focus();
            return;
        }

        const container = document.getElementById('results-container');
        const loader = document.getElementById('loading');
        
        container.innerHTML = '';
        loader.style.display = 'block';

        const style = document.getElementById('styleSelect').value;
        const ratio = document.getElementById('aspectRatio').value;
        let prompt = "";

        // å»ºæ§‹ Promptï¼Œç‰¹åˆ¥è¦æ±‚ä¸­æ–‡é¢¨æ ¼è§£æ
        if (currentMode === 'story') {
            const story = document.getElementById('storyPrompt').value;
            const anchor = document.getElementById('characterAnchor').value;
            const days = document.getElementById('dayCount').value;
            if(!story) { alert("è«‹è¼¸å…¥æ•…äº‹"); loader.style.display='none'; return; }

            prompt = `
                Role: Video Director.
                Model: ${MODEL_ID}
                Task: Create a ${days}-part video prompt series.
                
                Input Data:
                - Story: "${story}"
                - Visual Style: "${style}"
                - Consistency Anchor: "${anchor}"
                - Ratio: "${ratio}"

                STRICT OUTPUT FORMAT (Must allow parsing):
                ---TITLE_EN---
                (English Title)
                ---TITLE_ZH---
                (ä¸­æ–‡æ¨™é¡Œ)
                ---HASHTAGS---
                (#tags)
                ---SCENE 1_ZH---
                (åœ¨æ­¤è™•ç”¨ä¸­æ–‡è©³ç´°æè¿°é€™ä¸€å¹•çš„ç•«é¢èˆ‡é¢¨æ ¼è¨­å®šï¼Œä¾‹å¦‚ï¼šé¡é ­æ¡ç”¨ä½è§’åº¦æ‹æ”ï¼Œå¼·èª¿é›ªåœ°çš„å­¤å¯‚æ„Ÿï¼Œå…‰ç·šç‚ºæ¸…æ™¨å†·è‰²èª¿ã€‚)
                ---SCENE 1_EN---
                (The highly detailed English prompt for video AI. Must include style keywords and ${ratio}.)
                ---SCENE 2_ZH---
                (Chinese description for scene 2...)
                ---SCENE 2_EN---
                (English prompt for scene 2...)
                (Continue for all scenes)
            `;
        } else {
            const single = document.getElementById('singlePrompt').value;
            if(!single) { alert("è«‹è¼¸å…¥æè¿°"); loader.style.display='none'; return; }
            prompt = `
                Task: Expand video prompt. Input: "${single}". Style: "${style}". 
                Output Format: 
                ---TITLE_EN--- (Title) 
                ---TITLE_ZH--- (Title) 
                ---HASHTAGS--- (#tags)
                ---SCENE 1_ZH--- (ç”¨ä¸­æ–‡è§£é‡‹æ­¤ç•«é¢çš„é¢¨æ ¼èˆ‡ç´°ç¯€è¨­å®š)
                ---SCENE 1_EN--- (Expanded English prompt with ${ratio})
            `;
        }

        try {
            // ä½¿ç”¨æŒ‡å®šçš„ gemini-2.5-flash-lite
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/${MODEL_ID}:generateContent?key=${API_KEY}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });

            const data = await response.json();
            
            if (data.error) {
                // å¦‚æœæŒ‡å®šçš„ 2.5 æ¨¡å‹ä¸å¯ç”¨ï¼Œè‡ªå‹•é™ç´šä¸¦é€šçŸ¥
                throw new Error(data.error.message);
            }

            if (!data.candidates) throw new Error("No response content.");

            renderResults(data.candidates[0].content.parts[0].text);

        } catch (error) {
            container.innerHTML = `
                <div style="background:#fee2e2; border:1px solid #ef4444; padding:20px; border-radius:10px; color:#b91c1c;">
                    <strong>âš ï¸ ç™¼ç”ŸéŒ¯èª¤ï¼š</strong> ${error.message}<br><br>
                    è‹¥é¡¯ç¤º "not found"ï¼Œå¯èƒ½æ˜¯æ‚¨çš„ API Key å°šæœªé–‹é€š 2.5 æ¬Šé™ã€‚<br>
                    æ‚¨å¯ä»¥å˜—è©¦åœ¨ç¨‹å¼ç¢¼ä¸­å°‡ MODEL_ID æ”¹å› "models/gemini-1.5-flash"ã€‚
                </div>`;
        } finally {
            loader.style.display = 'none';
        }
    }

    function renderResults(text) {
        const container = document.getElementById('results-container');
        
        // è§£ææ¨™é¡Œ
        const titleEn = (text.match(/---TITLE_EN---\s*([\s\S]*?)\s*---TITLE_ZH---/) || [])[1] || "";
        const titleZh = (text.match(/---TITLE_ZH---\s*([\s\S]*?)\s*---HASHTAGS---/) || [])[1] || "";
        const hashtags = (text.match(/---HASHTAGS---\s*([\s\S]*?)\s*(---SCENE 1_ZH---|$)/) || [])[1] || "";

        // é¡¯ç¤ºæ¨™é¡Œå¡
        container.innerHTML += `
            <div class="output-card">
                <div class="output-body" style="background: linear-gradient(to right, #eef2ff, #fff);">
                    <h3 style="margin:0; color:#4338ca;">ğŸ“º ${titleZh}</h3>
                    <div style="color:#6b7280; font-size:0.9rem; margin-top:5px;">${titleEn}</div>
                    <div style="color:#ec4899; font-weight:bold; margin-top:10px; font-size:0.9rem;">${hashtags}</div>
                </div>
            </div>
        `;

        // è§£æåˆ†é¡ (ä¸­è‹±å°ç…§)
        // Regex: å°‹æ‰¾ SCENE X_ZH ... SCENE X_EN ... 
        const regex = /---SCENE \d+_ZH---\s*([\s\S]*?)\s*---SCENE \d+_EN---\s*([\s\S]*?)(?=---SCENE|$)/g;
        let match;
        let idx = 1;

        while ((match = regex.exec(text)) !== null) {
            const zhDesc = match[1].trim();
            const enPrompt = match[2].trim() + CTA_PHRASE;
            
            container.innerHTML += `
                <div class="output-card">
                    <div class="output-header">
                        <span class="scene-badge">Scene ${idx}</span>
                        <button class="copy-btn" onclick="navigator.clipboard.writeText(\`${enPrompt.replace(/`/g, "\\`")}\`);this.innerText='âœ… å·²è¤‡è£½';setTimeout(()=>this.innerText='ğŸ“‹ è¤‡è£½è‹±æ–‡ Prompt',2000);">
                            ğŸ“‹ è¤‡è£½è‹±æ–‡ Prompt
                        </button>
                    </div>
                    <div class="output-body">
                        <div class="zh-desc">
                            <strong>ğŸ‡¹ğŸ‡¼ ç•«é¢èˆ‡é¢¨æ ¼è§£æï¼š</strong><br>
                            ${zhDesc}
                        </div>
                        
                        <div class="en-prompt">${match[2].trim()}</div> <div class="cta-note">
                            <span>ğŸ‘‡ è¤‡è£½æ™‚æœƒè‡ªå‹•åŒ…å«äº’å‹•å¼•å°èª (CTA)</span>
                        </div>
                    </div>
                </div>
            `;
            idx++;
        }
    }
</script>

</body>
</html>
