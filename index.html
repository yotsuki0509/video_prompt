<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI å½±ç‰‡å°æ¼”å·¥ä½œå° (V3 ä¿®æ­£ç‰ˆ)</title>
    <style>
        :root {
            --primary: #6366f1;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text: #334155;
            --danger-bg: #fee2e2;
            --danger-border: #ef4444;
        }
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); padding: 20px; line-height: 1.6; }
        .container { max-width: 1100px; margin: 0 auto; }
        
        /* Header */
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: var(--primary); margin: 0; font-size: 2.2rem; }
        .header p { color: #64748b; }

        /* Tabs */
        .tabs { display: flex; justify-content: center; margin-bottom: 25px; background: #e2e8f0; padding: 5px; border-radius: 12px; display: inline-flex; }
        .tab { padding: 10px 30px; cursor: pointer; border-radius: 8px; font-weight: bold; transition: 0.3s; color: #64748b; }
        .tab.active { background: white; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        /* Layout */
        .dashboard { display: grid; grid-template-columns: 380px 1fr; gap: 25px; }
        .sidebar { background: var(--card-bg); padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05); height: fit-content; }
        .main-content { background: var(--card-bg); padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05); min-height: 600px; }

        /* Forms */
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: 700; margin-bottom: 8px; color: #475569; }
        input, textarea, select { width: 100%; padding: 12px 15px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 15px; box-sizing: border-box; transition: 0.2s; background: #f8fafc; }
        input:focus, textarea:focus, select:focus { border-color: var(--primary); outline: none; background: white; }
        textarea { resize: vertical; }

        /* ğŸ”´ API Key ç‰¹é¡¯å€åŸŸ (é‡é»ä¿®æ”¹) */
        .api-key-box { 
            background: var(--danger-bg); 
            border: 2px dashed var(--danger-border); 
            padding: 15px; 
            border-radius: 12px; 
            margin-bottom: 30px; 
        }
        .api-key-box label { color: #b91c1c; display: flex; justify-content: space-between; align-items: center; }
        .api-key-box input { border: 1px solid var(--danger-border); background: #fff; }
        .status-badge { font-size: 12px; background: #10b981; color: white; padding: 3px 8px; border-radius: 4px; display: none; }

        /* Button */
        .btn-primary { width: 100%; background: var(--primary); color: white; padding: 15px; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; box-shadow: 0 4px 15px -3px rgba(99, 102, 241, 0.3); }
        .btn-primary:hover { background: #4f46e5; transform: translateY(-2px); }

        /* Output & Utilities */
        .hidden { display: none; }
        .output-card { background: #f8fafc; border: 2px solid #e2e8f0; padding: 20px; margin-bottom: 20px; border-radius: 12px; }
        .prompt-text { font-family: monospace; white-space: pre-wrap; background: white; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .loading { text-align: center; padding: 50px; display: none; color: var(--primary); font-weight: bold; }
        .copy-btn { float: right; cursor: pointer; background: white; border: 1px solid #ccc; padding: 2px 8px; border-radius: 4px; font-size: 12px; }
        
        @media (max-width: 900px) { .dashboard { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>ğŸ¬ AI å½±ç‰‡å°æ¼”å·¥ä½œå° (V3)</h1>
        <p>è«‹å…ˆåœ¨ä¸‹æ–¹ç´…è‰²æ¡†æ¡†å…§è¼¸å…¥æ‚¨çš„ API Key</p>
    </div>

    <div style="text-align: center;">
        <div class="tabs">
            <div class="tab active" onclick="switchMode('story')">ğŸ“½ï¸ é€£è¼‰æ•…äº‹æ¨¡å¼</div>
            <div class="tab" onclick="switchMode('single')">ğŸ“¸ å–®é¡é ­æ¨¡å¼</div>
        </div>
    </div>

    <div class="dashboard">
        <div class="sidebar">
            
            <div class="api-key-box">
                <label>
                    ğŸ”‘ Gemini API Key 
                    <span id="keyStatus" class="status-badge">âœ… å·²å„²å­˜</span>
                </label>
                <input type="password" id="apiKeyInput" placeholder="è«‹åœ¨æ­¤è²¼ä¸Š API Key..." oninput="saveKey()">
                <small style="color:#b91c1c; font-size:12px; margin-top:5px; display:block;">
                    *è¼¸å…¥å¾Œæœƒè‡ªå‹•å„²å­˜ï¼Œä¸ç”¨æŒ‰ Enterã€‚
                </small>
            </div>

            <div class="form-group">
                <label>ğŸ¨ è¦–è¦ºé¢¨æ ¼</label>
                <select id="styleSelect">
                    <option value="Cinematic, 35mm lens, golden hour">é›»å½±æ„Ÿ (Cinematic)</option>
                    <option value="Studio Ghibli anime style">å‰åœåŠ›å‹•ç•« (Ghibli)</option>
                    <option value="Cyberpunk, neon lights">è³½åšé¾å…‹ (Cyberpunk)</option>
                    <option value="Photorealistic, 8k">è¶…å¯«å¯¦æ”å½± (Photorealistic)</option>
                </select>
            </div>

            <div id="story-inputs">
                <div class="form-group">
                    <label>ğŸ“– æ•…äº‹å¤§ç¶±</label>
                    <textarea id="storyPrompt" rows="5" placeholder="è¼¸å…¥æ‚¨çš„æ•…äº‹æƒ³æ³•..."></textarea>
                </div>
                <div class="form-group">
                    <label>ğŸ”’ ä¸»è§’é–å®š (é‡è¦)</label>
                    <input type="text" id="characterAnchor" placeholder="ä¾‹å¦‚ï¼šCute red fox with blue scarf">
                </div>
                <div class="form-group">
                    <label>ğŸ“… åˆ†é¡æ•¸é‡</label>
                    <select id="dayCount">
                        <option value="3">3 å€‹åˆ†é¡</option>
                        <option value="5" selected>5 å€‹åˆ†é¡</option>
                    </select>
                </div>
            </div>

            <div id="single-inputs" class="hidden">
                <div class="form-group">
                    <label>ğŸ¯ ç•«é¢æè¿°</label>
                    <textarea id="singlePrompt" rows="6" placeholder="æè¿°ç•«é¢..."></textarea>
                </div>
            </div>

            <div class="form-group">
                <label>ğŸ“ ç•«å¹…æ¯”ä¾‹</label>
                <select id="aspectRatio">
                    <option value="--ar 9:16">9:16 (ç›´å‘)</option>
                    <option value="--ar 16:9">16:9 (æ©«å‘)</option>
                </select>
            </div>

            <button class="btn-primary" onclick="generateScript()">âœ¨ é–‹å§‹ç”Ÿæˆ</button>
        </div>

        <div class="main-content">
            <div id="loading" class="loading">AI æ­£åœ¨ç”Ÿæˆä¸­...</div>
            <div id="results-container">
                <div style="text-align: center; color: #999; margin-top: 100px;">
                    è«‹åœ¨å·¦å´ç´…è‰²æ¡†æ¡†è²¼ä¸Š API Key<br>ç„¶å¾Œè¼¸å…¥æ•…äº‹ä¸¦é»æ“Šç”Ÿæˆ
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const CTA_PHRASE = "\n\nIf you have a story you want to see, leave a comment!";
    let currentMode = 'story';

    // ğŸŸ¢ åˆå§‹åŒ–ï¼šæª¢æŸ¥ Key
    window.onload = function() {
        const savedKey = localStorage.getItem("gemini_api_key_v3");
        if (savedKey) {
            document.getElementById("apiKeyInput").value = savedKey;
            document.getElementById("keyStatus").style.display = "inline-block";
        }
    }

    // ğŸŸ¢ è‡ªå‹•å„²å­˜ Key
    function saveKey() {
        const key = document.getElementById("apiKeyInput").value.trim();
        if (key) {
            localStorage.setItem("gemini_api_key_v3", key); // ä½¿ç”¨æ–°çš„ key åç¨±é¿å…è¡çª
            document.getElementById("keyStatus").style.display = "inline-block";
        }
    }

    function switchMode(mode) {
        currentMode = mode;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');
        document.getElementById('story-inputs').classList.toggle('hidden', mode !== 'story');
        document.getElementById('single-inputs').classList.toggle('hidden', mode !== 'single');
    }

    async function generateScript() {
        const API_KEY = document.getElementById("apiKeyInput").value.trim();
        if (!API_KEY) {
            alert("ğŸš¨ è«‹å…ˆåœ¨å·¦ä¸Šè§’çš„ç´…è‰²å€åŸŸè¼¸å…¥ API Keyï¼");
            document.getElementById("apiKeyInput").focus();
            return;
        }

        const container = document.getElementById('results-container');
        const loader = document.getElementById('loading');
        
        container.innerHTML = '';
        loader.style.display = 'block';

        const style = document.getElementById('styleSelect').value;
        const ratio = document.getElementById('aspectRatio').value;
        let prompt = "";

        if (currentMode === 'story') {
            const story = document.getElementById('storyPrompt').value;
            const anchor = document.getElementById('characterAnchor').value;
            const days = document.getElementById('dayCount').value;
            if(!story) { alert("è«‹è¼¸å…¥æ•…äº‹"); loader.style.display='none'; return; }

            prompt = `
                Role: Video Director.
                Task: Create a ${days}-part video prompt series.
                Story: "${story}"
                Style: "${style}"
                Anchor: "${anchor}"
                
                STRICT FORMAT:
                ---TITLE_EN---
                (Title)
                ---TITLE_ZH---
                (ä¸­æ–‡æ¨™é¡Œ)
                ---HASHTAGS---
                (#tags)
                ---SCENE 1---
                (Prompt 1...)
                ---SCENE 2---
                (Prompt 2...)
            `;
        } else {
            const single = document.getElementById('singlePrompt').value;
            if(!single) { alert("è«‹è¼¸å…¥æè¿°"); loader.style.display='none'; return; }
            prompt = `Task: Expand video prompt. Input: "${single}". Style: "${style}". Format: ---TITLE_EN--- ... ---SCENE 1--- ...`;
        }

        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-lite:generateContent?key=${API_KEY}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });

            const data = await response.json();
            if (data.error) throw new Error(data.error.message);
            renderResults(data.candidates[0].content.parts[0].text);

        } catch (error) {
            container.innerHTML = `<div style="color:red; padding:20px;">éŒ¯èª¤: ${error.message}</div>`;
        } finally {
            loader.style.display = 'none';
        }
    }

    function renderResults(text) {
        const container = document.getElementById('results-container');
        
        // ç°¡å–®è§£æé‚è¼¯
        const titleEn = (text.match(/---TITLE_EN---\s*([\s\S]*?)\s*---TITLE_ZH---/) || [])[1] || "Generating...";
        const titleZh = (text.match(/---TITLE_ZH---\s*([\s\S]*?)\s*---HASHTAGS---/) || [])[1] || "...";
        const hashtags = (text.match(/---HASHTAGS---\s*([\s\S]*?)\s*(---SCENE 1---|$)/) || [])[1] || "";

        container.innerHTML += `
            <div class="output-card" style="background:#eef2ff;">
                <h3>ğŸ“º ${titleZh} <br><small>${titleEn}</small></h3>
                <p style="color:#6366f1">${hashtags}</p>
            </div>
        `;

        const scenes = text.split(/---SCENE \d+---/).slice(1);
        scenes.forEach((scene, idx) => {
            const content = scene.trim() + CTA_PHRASE;
            container.innerHTML += `
                <div class="output-card">
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                        <span style="background:#6366f1; color:white; padding:2px 8px; border-radius:10px;">Scene ${idx+1}</span>
                        <button class="copy-btn" onclick="navigator.clipboard.writeText(\`${content.replace(/`/g, "\\`")}\`);alert('å·²è¤‡è£½')">è¤‡è£½</button>
                    </div>
                    <div class="prompt-text">${scene.trim()}</div>
                    <div style="margin-top:10px; font-size:12px; color:#666;">ğŸ‘‡ çµå°¾å·²è‡ªå‹•åŠ å…¥äº’å‹•èª</div>
                </div>
            `;
        });
    }
</script>

</body>
</html>
